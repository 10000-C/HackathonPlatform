{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-ad430c975dc6038d3a217db82ae2b8424fff8341",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/ActivitiesManagement.sol": "project/contracts/ActivitiesManagement.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/ActivitiesManagement.sol": {
        "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.28;\r\n\r\nimport \"./AuthorityManagement.sol\";\r\n\r\ncontract ActivitiesManagement { \r\n    event ActivityCreated(uint256 indexed activityId, Activity activity);\r\n    event ActivityUpdated(uint256 indexed activityId, Activity activity);\r\n    event ParticipantAdded(uint256 indexed activityId, address participant);\r\n    event ParticipantRemoved(uint256 indexed activityId, address participant);\r\n    event ActivityDeleted(uint256 indexed activityId, address user);\r\n    \r\n    struct Activity {\r\n        string dataCID; //IPFS CID for JSON metadata\r\n        string topic;\r\n        address creator;\r\n        uint256 maxParticipants;\r\n        uint256 cuParticipants;\r\n        uint256 activityId;\r\n    }\r\n    mapping(uint256 => mapping(address => bool)) public isParticipant;\r\n    AuthorityManagement private authorityManagement;\r\n    \r\n    mapping(uint256 => Activity) public activities;\r\n    uint256 public activityCount; \r\n    \r\n    constructor(address _authorityManagementAddress) {\r\n        authorityManagement = AuthorityManagement(_authorityManagementAddress);\r\n    }\r\n\r\n    function compareStrings(string memory a, string memory b) internal pure returns (bool) {\r\n        return (keccak256(abi.encodePacked((a))) == keccak256(abi.encodePacked((b))));\r\n    }\r\n\r\n    function createActivity(\r\n        string memory _dataCID,\r\n        string memory _topic,\r\n        uint256 _maxParticipants,\r\n        uint256 _cuParticipants\r\n    ) public onlyOrganizer {\r\n        activityCount++;\r\n        Activity memory newActivity = Activity({\r\n            dataCID: _dataCID,\r\n            creator: msg.sender,\r\n            maxParticipants: _maxParticipants,\r\n            cuParticipants: _cuParticipants,\r\n            activityId: activityCount,\r\n            topic: _topic\r\n        });\r\n        activities[activityCount] = newActivity;\r\n        emit ActivityCreated(activityCount, newActivity);\r\n    }\r\n\r\n    function updateActivity(\r\n        uint256 _activityId,\r\n        string memory _dataCID,\r\n        string memory _topic,\r\n        uint256 _maxParticipants\r\n    ) public onlyOrganizer {\r\n        require(_activityId > 0 && _activityId <= activityCount, \"Invalid activity ID\");\r\n        require(activities[_activityId].creator == msg.sender, \"Not the creator of the activity\");\r\n        Activity storage activity = activities[_activityId];\r\n        activity.dataCID = _dataCID;\r\n        activity.topic = _topic;\r\n        activity.maxParticipants = _maxParticipants;\r\n        emit ActivityUpdated(_activityId, activity);\r\n    }\r\n\r\n    function deleteActivity(uint256 _activityId) public onlyOrganizer {\r\n        require(_activityId > 0 && _activityId <= activityCount, \"Invalid activity ID\");\r\n        require(activities[_activityId].creator != address(0), \"Activity does not exist\");\r\n        require(activities[_activityId].creator == msg.sender, \"Not the creator of the activity\");\r\n        delete activities[_activityId];\r\n        emit ActivityDeleted(_activityId, msg.sender);\r\n    } \r\n\r\n    function deleteActivityForAdmin(uint256 _activityId) public onlyAdmin {\r\n        require(_activityId > 0 && _activityId <= activityCount, \"Invalid activity ID\");\r\n        require(activities[_activityId].creator != address(0), \"Activity does not exist\");\r\n        delete activities[_activityId];\r\n        emit ActivityDeleted(_activityId, msg.sender);\r\n    }\r\n\r\n    function getActivity(uint256 _activityId) public view returns (Activity memory) {\r\n        require(_activityId > 0 && _activityId <= activityCount, \"Invalid activity ID\");\r\n        require(activities[_activityId].creator != address(0), \"Activity does not exist\");\r\n        return activities[_activityId];\r\n    }\r\n\r\n    function participateInActivity(uint256 _activityId) public onlyLegalUser {\r\n        require(_activityId > 0 && _activityId <= activityCount, \"Invalid activity ID\");\r\n        require(isParticipant[_activityId][msg.sender] == false, \"Already participated in this activity\");\r\n        require(activities[_activityId].cuParticipants<activities[_activityId].maxParticipants, \"Activity is full\");\r\n        \r\n        isParticipant[_activityId][msg.sender] = true;\r\n        activities[_activityId].cuParticipants++;\r\n        emit ParticipantAdded(_activityId, msg.sender);\r\n    } \r\n\r\n    function withdrawFromActivity(uint256 _activityId) public onlyLegalUser {\r\n        require(_activityId > 0 && _activityId <= activityCount, \"Invalid activity ID\");\r\n        require(isParticipant[_activityId][msg.sender] == true, \"Not a participant in this activity\");\r\n        \r\n        isParticipant[_activityId][msg.sender] = false;\r\n        activities[_activityId].cuParticipants--;\r\n        emit ParticipantRemoved(_activityId, msg.sender);\r\n    }\r\n\r\n    function isParticipantInActivity(uint256 _activityId, address _user) public view returns (bool) {\r\n        require(_activityId > 0 && _activityId <= activityCount, \"Invalid activity ID\");\r\n        return isParticipant[_activityId][_user];\r\n    }\r\n\r\n    modifier onlyOrganizer() {\r\n        require(authorityManagement.isAnOrganizer(msg.sender), \"Not an organizer\");\r\n        _;\r\n    }\r\n\r\n    modifier onlyLegalUser() {\r\n        require(!authorityManagement.isBlockedUser(msg.sender), \"User is blocked\");\r\n        _;\r\n    }\r\n\r\n    modifier onlyAdmin() {\r\n        require(authorityManagement.isAdmin(msg.sender), \"Not an admin\");\r\n        _;\r\n    }\r\n}"
      },
      "project/contracts/AuthorityManagement.sol": {
        "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.28;\r\n\r\ncontract AuthorityManagement {\r\n    event AdminAdded(address indexed admin);\r\n    event AdminRemoved(address indexed admin);\r\n    event UserBlocked(address indexed user);\r\n    event UserUnblocked(address indexed user);\r\n\r\n    address public owner;\r\n    mapping(address => bool) private authority;// admin\r\n    mapping(address => bool) private isBlocked;\r\n    mapping(address => bool) private isOrganizer;\r\n\r\n    constructor() {\r\n        owner = msg.sender;\r\n        authority[msg.sender] = true;\r\n    }\r\n    //manage admin\r\n    function addAdmin(address _admin) public onlyOwner {\r\n        authority[_admin] = true;\r\n        emit AdminAdded(_admin);\r\n    }\r\n\r\n    function removeAdmin(address _admin) public onlyOwner {\r\n        authority[_admin] = false;\r\n        emit AdminRemoved(_admin);\r\n    }\r\n\r\n    function isAdmin(address _admin) public view returns (bool) {\r\n        return authority[_admin];\r\n    }\r\n    //manage blocked user\r\n    function blockUser(address _user) public onlyAdmin {\r\n        isBlocked[_user] = true;\r\n        emit UserBlocked(_user);\r\n    }\r\n\r\n    function unblockUser(address _user) public onlyAdmin {\r\n        isBlocked[_user] = false;\r\n        emit UserUnblocked(_user);\r\n    } \r\n\r\n    function isBlockedUser(address _user) public view returns (bool) {\r\n        return isBlocked[_user];\r\n    }\r\n\r\n    //manage organizer\r\n    function addOrganizer(address _organizer) public onlyAdmin {\r\n        isOrganizer[_organizer] = true;\r\n    }\r\n    function removeOrganizer(address _organizer) public onlyAdmin {\r\n        isOrganizer[_organizer] = false;\r\n    }\r\n    function isAnOrganizer(address _organizer) public view returns (bool) {\r\n        return isOrganizer[_organizer];\r\n    }\r\n\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner, \"Not the owner\");\r\n        _;\r\n    }\r\n\r\n    modifier onlyAdmin() {\r\n        require(authority[msg.sender], \"Not the admin\");\r\n        _;\r\n    }\r\n}"
      }
    }
  }
}